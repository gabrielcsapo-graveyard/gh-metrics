#!/usr/bin/env node
"use strict"

const Program = require('commander');
const Metrics = require('../index.js');
const Table = require('markdown-table');

Program
    .version(require('../package.json').version)
    .option('-u, --user [user]', 'the name of the user that you want to get metrics for.')
    .option('-t, --token [token]', 'github access token to make requests.')
    .option('-k, --keys [keys]', 'keys to be passed to make the table based on the comma seperated keys you provide.')
    .option('-s, --sort [sort]', 'key to be used to sort against the returned value')
    .option('-a, --asc', 'by default the sorting is descending if this is selected it will be ascending')
    .parse(process.argv);

if (Program.user) {
    Program.keys = Program.keys.split(',').map((k) => {
        return k.trim();
    }) || ['full_name', 'homepage', 'description', 'created_at', 'size'];
    Metrics({
        user: Program.user,
        token: Program.token,
        keys: Program.keys,
        sort: Program.sort,
        sortAsc: Program.asc ? true : false
    }, function(err, metrics) {
        if(err) {
            return console.error(err);
        }

        const keys = Program.keys;
        const table = [keys];

        metrics.forEach(function(m) {
            let row = [];
            keys.forEach(function(key) {
                row.push(m[key] ? JSON.stringify(m[key]) : m[key]);
            });
            table.push(row);
        });
        console.log(Table(table));
    });
} else {
    console.error('please specify a user\n');
}
